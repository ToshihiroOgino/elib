{{template "header" .}}

<body>
  <div class="container-fluid p-0">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
      <div class="container-fluid">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1 me-2">
            <h3
              class="mb-0 text-white"
              onclick="editTitle()"
              style="
                cursor: pointer;
                font-size: 1.75rem;
                font-weight: 500;
                background-color: rgba(255, 255, 255, 0.3);
                padding: 8px 16px;
                border-radius: 8px;
              "
            >
              <span id="note-title">{{.note.Title | escapeHTML}}</span>
              <input
                type="text"
                id="title-input"
                value="{{.note.Title | escapeHTML}}"
                class="form-control d-none"
                style="font-size: 1.75rem; font-weight: 500"
                onblur="saveTitle()"
                onkeypress="if(event.key==='Enter') saveTitle()"
              />
            </h3>
          </div>
          <button class="btn btn-outline-light me-2" onclick="createNewNote()">
            æ–°è¦
          </button>
          <button class="btn btn-outline-light me-2" onclick="saveNote()">
            ä¿å­˜
          </button>
          <button class="btn btn-outline-light me-2" onclick="deleteNote()">
            å‰Šé™¤
          </button>
          <button class="btn btn-outline-light me-2" onclick="shareReadonly()">
            å…±æœ‰(é–²è¦§ã®ã¿)
          </button>
          <button class="btn btn-outline-light me-2" onclick="shareEditable()">
            å…±æœ‰(ç·¨é›†å¯)
          </button>
          <form action="/user/logout" method="POST" class="d-inline">
            <button type="submit" class="btn btn-outline-light me-2">
              ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </button>
          </form>
        </div>
        <div class="text-white">è¡Œæ•°: <span id="line-count">1</span></div>
      </div>
    </nav>

    <div class="row g-0">
      <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
      <div
        class="col-md-3 bg-light border-end d-flex flex-column"
        style="height: calc(100vh - 56px)"
      >
        <!-- ãƒ¡ãƒ¢ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="p-3 flex-grow-1 d-flex flex-column" style="min-height: 0">
          <h6 class="mb-3">ãƒ¡ãƒ¢ä¸€è¦§</h6>
          <div
            id="notes-list"
            class="flex-grow-1"
            style="overflow-y: auto; min-height: 200px"
          >
            {{range .notes}}
            <div
              class="card mb-2 note-item"
              data-note-id="{{.ID | escapeHTML}}"
              onclick="selectNote('{{.ID | safeJSON}}')"
            >
              <div class="card-body p-2">
                <h6 class="card-title mb-1" style="font-size: 0.9rem">
                  {{.Title | escapeHTML}}
                </h6>
                <small
                  class="text-muted"
                  data-utc-time='{{.UpdatedAt.Format "2006-01-02T15:04:05"}}'
                  >{{.UpdatedAt.Format "2006/01/02 15:04"}}</small
                >
              </div>
            </div>
            {{end}}
          </div>
        </div>

        <!-- ã‚·ã‚§ã‚¢ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div
          class="border-top p-3 d-flex flex-column"
          style="height: 40%; min-height: 150px"
        >
          <h6 class="mb-3">å…±æœ‰ãƒªãƒ³ã‚¯</h6>
          <div id="shares-list" class="flex-grow-1" style="overflow-y: auto">
            {{range $index, $share := .shares}}
            <div class="card mb-2 share-item">
              <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <span class="badge bg-secondary me-2 share-number"></span>
                    {{if $share.Editable}}
                    <small class="text-success">ç·¨é›†å¯</small>
                    {{else}}
                    <small class="text-info">é–²è¦§ã®ã¿</small>
                    {{end}}
                  </div>
                  <div>
                    <button
                      class="btn btn-sm btn-outline-primary me-1"
                      onclick="copyShareLink('{{$share.ID | safeJSON}}')"
                      title="ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼"
                    >
                      ğŸ“‹
                    </button>
                    <button
                      class="btn btn-sm btn-outline-danger"
                      onclick="deleteShare('{{$share.ID | safeJSON}}')"
                      title="å‰Šé™¤"
                    >
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {{else}}
            <div class="text-muted small">å…±æœ‰ãƒªãƒ³ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</div>
            {{end}}
          </div>
        </div>
      </div>

      <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <div class="col-md-9">
        <div
          class="p-3"
          style="height: calc(100vh - 56px - 40px); overflow-y: auto"
        >
          <form id="note-form">
            <input type="hidden" id="note-id" value="{{.note.ID | escapeHTML}}" />
            <textarea
              id="note-content"
              class="form-control"
              rows="30"
              style="
                resize: none;
                border: none;
                outline: none;
                font-family: monospace;
                line-height: 1.5;
              "
              placeholder="ã“ã“ã«ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
              oninput="updateStats()"
            >{{.note.Content | escapeHTML}}</textarea>
          </form>
        </div>
      </div>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <div class="bg-secondary text-white p-2 fixed-bottom">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3">
            ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®: <span id="cursor-position">1:1</span>
          </div>
          <div class="col-md-3">æ–‡å­—æ•°: <span id="char-count">0</span></div>
          <div class="col-md-3">è¡Œæ•°: <span id="total-lines">1</span></div>
          <div class="col-md-3">
            ä¿å­˜çŠ¶æ…‹: <span id="save-status">ä¿å­˜æ¸ˆã¿</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // noteIdã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦è¨­å®š
    window.noteId = "{{.note.ID | safeJSON}}";
  </script>
  <script src="/static/js/editor.js"></script>
</body>

{{template "footer"}}
